<script type="text/x-iobroker" data-template-name="sourceanalytix">
    <!--
    <div class="section">
        <div class="divider"></div>
        <h4 class="translate">Basic settings</h4>
    </div> 
    -->
<div class="row">
    <div class="input-field col s2">
        <input type="checkbox" data-field="enabled" data-default="false" />
        <span class="translate">enabled</span>
    </div>
    <div class="input-field col s4">
        <input placeholder="Leave empty to use object's name" type="text" data-field="alias" />
        <label for="alias" class="translate">Alias</label>
    </div>
    <div class="input-field col s2">
        <select class="value" data-field="state_type">
            <option value="kWh_consumption" class="translate">Electricity consumption</option>
            <option value="kWh_consumption_night" class="translate">Electricity consumption night</option>
            <!--
                <option value="kWh_counter" class="translate">kWh counter</option>
                -->
            <option value="kWh_delivery" class="translate">Electricity delivery</option>
            <option value="kWh_heatpomp" class="translate">Heat pump</option>
            <option value="kWh_heatpomp_night" class="translate">Heat pump night</option>
            <option value="gas" class="translate">Gas</option>
            <option value="water_m3" class="translate">Water</option>
            <option value="oil_m3" class="translate">Oil</option>
        </select>
        <label for="language" class="translate">Measurement type</label>
    </div>

    <div class="input-field col s3">
        <select id="elements-select">
            <option value="" disabled selected>Choose option</option>
        </select>
        <label for="elements-select" class="translate">Select</label>
    </div>

    <!--
    <div class="input-field col s2">
        <select class="value" data-field="state_unit">
            <option value="automatically" class="translate">automatically</option>
            <option value="kWh" class="translate">kWh</option>
            <option value="wh" class="translate">Wh</option>
            <option value="w" class="translate">W</option>
            <option value="m3" class="translate">m3</option>
            <option value="l" class="translate">l</option>
        </select>
        <label for="language" class="translate">Measurement unit</label>
    </div>
    -->
    <!--
        <div class="input-field col s2">
            <input data-field="impuls" type="number" data-default="400" />
            <label for="impuls" class="translate">counter pulse</label>
        </div>
        -->
</div>
<div class="section">
    <div class="divider"></div>
    <h6 class="translate">What should be evaluated</h6>
</div>
<div class="row">
    <!--
            <div class="input-field col s1">
            </div>
            -->
    <div class="input-field col s2">
        <input type="checkbox" data-field="costs" data-default="false" />
        <span class="translate">Costs</span>
    </div>

    <div class="switch col s4">
        <label>
            (without basic charge)
            <input type="checkbox">
            <span class="lever"></span>
            (including basic charge)
        </label>
    </div>


    <!--
            <div class="input-field col s3">
                <input type="checkbox" data-field="costs" data-default="false"/>
                <span class="translate">(without basic charge)</span>
            </div>
            -->

    <div class="input-field col s2">
        <input type="checkbox" data-field="consumption" data-default="false" />
        <span class="translate">consumption</span>
    </div>
    <div class="input-field col s2">
        <input type="checkbox" data-field="meter_values" data-default="false" />
        <span class="translate">counter values</span>
    </div>
</div>
<div class="section">
    <div class="divider"></div>
    <h6 class="translate">Please enter start values in kWh or m3 !</h6>
</div>
<div class="row">
    <div class="input-field col s2">
    </div>
    <!-- Remove start value, not need for this moment pending calculation logic periode start     
        <div class="input-field col s2">
                <input data-field="start_meassure" type="number" data-default="0" />
                <label for="start_meassure" class="translate">start_meassure</label>
        </div>
        -->
    <div class="input-field col s2">
        <input data-field="start_day" type="number" data-default="0" />
        <label for="start_day" class="translate">Meter reading at day start</label>
    </div>
    <div class="input-field col s2">
        <input data-field="start_week" type="number" data-default="0" />
        <label for="start_week" class="translate">Meter reading at week start</label>
    </div>
    <div class="input-field col s2">
        <input data-field="start_month" type="number" data-default="0" />
        <label for="start_month" class="translate">Meter reading at month start</label>
    </div>
    <div class="input-field col s2">
        <input data-field="start_quarter" type="number" data-default="0" />
        <label for="start_quarter" class="translate">Meter reading at quarter start</label>
    </div>
    <div class="input-field col s2">
        <input data-field="start_year" type="number" data-default="0" />
        <label for="start_year" class="translate">Meter reading at year start</label>
    </div>
</div>

</script>

<!-- translations to-do = ALL !-->
<script type="text/javascript">

    var unitCat = [];
    var priceCat = [];

    console.log(`START`)
    async function getObject(id) {
        return new Promise((resolve, reject) => {
            gMain.socket.emit('getObject', id, function (err, res) {
                if (!err && res) {
                    resolve(res);
                } else {
                    resolve(null);
                }
            });
        });
    }

    /**
    // initialize dropdown menu for table function
    * If class as identifier is, you have to reinitialise all select elements.
     * @param {string }selector - id or class name, id: #myID, class: .myClass
     * @param {array} data - as array where the data has to be sorted in which order you like to display them
     */
    function fillSelect(selector, data) {
        $(selector).unbind('change');

        let selectInstance = M.FormSelect.getInstance($(selector));
        if (selectInstance) {
            selectInstance.destroy();
        }

        $(selector).empty();
        $(selector).append('<option vlaue="" selected>Choose</option>');

        for (let d in data) {
            $(selector).append('<option vlaue="' + data[d] + '">' + data[d] + '</option>');
        }

        instances = M.FormSelect.init($(selector));

        $(selector).on('change', (event) => {
            _onChange();
        })

    }

    function loopArray(settings) {
        for (var units in settings.unitConfig) {
            console.log(settings.unitConfig[units].uName)
            unitCat.push(settings.unitConfig[units].uName)
        }
        fillSelect('#elements-select', unitCat);

        // reinitialize all the Materialize labels on the page if you are dynamically adding inputs:
        if (M) M.updateTextFields();

        //initialize dropdowns
        $('.dropdown-trigger').dropdown();

    }


    $.get("adapter/sourceanalytix/words.js", function (script) {

        let tmp = await getObject(`system.adapter.coronavirus-statistics.0`);
    console.log(`Setting details custom object : ${tmp}`)
    
        // Objekt holen für das der custom Dialog geöffnet wurde
        // let objOfInstance = await getForeignObjects(`${myNamespace}.*`);
        // console.log(`SystemObject : ${objOfInstance}`)

        // var currentObj = system.adapter.sourceanalytix + '.0'
        // var currentObj = gMain.objects[gMain.navigateGetParams()];
        // console.log(`obj : ${JSON.stringify(currentObj)}`)
        //console.log(`Setting details custom object : ${JSON.stringify(settings)}`)
        // loopArray()
        let translation = script.substring(script.indexOf('{'), script.length);
        translation = translation.substring(0, translation.lastIndexOf(';'));
        $.extend(systemDictionary, JSON.parse(translation));
    });
</script>